<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Oney Second Brain</title>
<meta name="description" content="Dong & Oney's shared second brain â€” memories, projects, knowledge">
<meta name="theme-color" content="#0a0a0a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiT25leSBTZWNvbmQgQnJhaW4iLCJzaG9ydF9uYW1lIjoiU2Vjb25kIEJyYWluIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwYTBhMGEiLCJ0aGVtZV9jb2xvciI6IiMwYTBhMGEifQ==">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0a;--card:#1a1a1a;--border:#2a2a2a;--text:#e0e0e0;--muted:#888;--green:#2ECC85;--green2:#1FAD73;--purple:#6B4C9A;--purple-light:#9B59B6;--red:#e74c3c;--orange:#f39c12;--blue:#3498db;--pink:#ec4899}
[data-theme="light"]{--bg:#f5f5f5;--card:#fff;--border:#ddd;--text:#222;--muted:#666}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding-bottom:80px}
a{color:var(--green);text-decoration:none}

/* Header */
.header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;padding-top:max(12px, env(safe-area-inset-top));border-bottom:1px solid var(--border);background:rgba(10,10,10,0.95);position:sticky;top:0;z-index:100;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
.header-left{display:flex;align-items:center;gap:10px}
.header h1{font-size:18px;font-weight:600}
.header h1 span{color:var(--green)}

/* Search */
.search-wrap{position:relative;flex:1;max-width:300px;margin:0 16px}
.search-wrap input{width:100%;padding:8px 12px 8px 34px;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:14px;outline:none}
.search-wrap input:focus{border-color:var(--green)}
.search-icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--muted);font-size:14px}
.search-results{position:absolute;top:100%;left:0;right:0;background:var(--card);border:1px solid var(--border);border-radius:8px;max-height:400px;overflow-y:auto;display:none;z-index:200;margin-top:4px;box-shadow:0 8px 24px rgba(0,0,0,.4)}
.search-results.active{display:block}
.search-item{padding:10px 14px;border-bottom:1px solid var(--border);cursor:pointer}
.search-item:hover{background:rgba(46,204,133,.1)}
.search-item .cat{font-size:11px;color:var(--green);text-transform:uppercase}
.search-item .title{font-size:14px;margin-top:2px}
.search-item .snippet{font-size:12px;color:var(--muted);margin-top:2px}

/* Theme toggle */
.theme-btn{background:none;border:none;color:var(--muted);font-size:20px;cursor:pointer;padding:4px}

/* Bottom Tab Bar */
.tab-bar{position:fixed;bottom:0;left:0;right:0;background:rgba(10,10,10,0.98);border-top:1px solid var(--border);display:flex;justify-content:space-around;align-items:center;padding:6px 0;padding-bottom:max(6px,env(safe-area-inset-bottom));z-index:100;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
.tab-bar-item{display:flex;flex-direction:column;align-items:center;gap:2px;padding:4px 8px;border:none;background:none;color:var(--muted);font-size:10px;cursor:pointer;transition:.2s;min-width:0;flex:1}
.tab-bar-item .tab-icon{font-size:20px;line-height:1}
.tab-bar-item.active{color:var(--green)}
.tab-bar-item:hover{color:var(--text)}

/* More menu */
.more-menu{position:fixed;bottom:70px;right:8px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:8px;display:none;z-index:200;box-shadow:0 -4px 20px rgba(0,0,0,.4);min-width:160px}
.more-menu.active{display:block}
.more-menu-item{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:8px;cursor:pointer;font-size:14px;color:var(--text)}
.more-menu-item:hover{background:rgba(46,204,133,.1)}
.more-menu-item .mm-icon{font-size:18px}

/* Content */
.tab-content{display:none;padding:20px;max-width:1200px;margin:0 auto;animation:fadeIn .3s}
.tab-content.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

/* Cards */
.grid{display:grid;gap:16px}
.grid-2{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
.grid-3{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.grid-4{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px}
.card h3{font-size:15px;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.card h3 .emoji{font-size:18px}
.section-title{font-size:20px;font-weight:700;margin:24px 0 16px;display:flex;align-items:center;gap:8px}
.section-title:first-child{margin-top:0}

/* Stats */
.stat{text-align:center;padding:16px}
.stat .num{font-size:28px;font-weight:700;color:var(--green)}
.stat .label{font-size:12px;color:var(--muted);margin-top:4px}

/* Countdown */
.countdown{display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border)}
.countdown:last-child{border:none}
.countdown .days{font-size:24px;font-weight:700;color:var(--green);min-width:50px}
.countdown .info .name{font-size:14px;font-weight:600}
.countdown .info .date{font-size:12px;color:var(--muted)}

/* Activity */
.activity-item{padding:10px 0;border-bottom:1px solid var(--border)}
.activity-item:last-child{border:none}
.activity-item .date{font-size:11px;color:var(--green);font-weight:600}
.activity-item .desc{font-size:13px;margin-top:2px}

/* Todo */
.todo{padding:8px 0;display:flex;align-items:flex-start;gap:8px;border-bottom:1px solid var(--border)}
.todo:last-child{border:none}
.todo .check{color:var(--muted);font-size:16px;flex-shrink:0;margin-top:1px}
.todo .check.done{color:var(--green)}
.todo .text{font-size:13px;flex:1}
.todo .todo-del{background:none;border:none;color:var(--muted);font-size:14px;cursor:pointer;padding:2px 6px;opacity:0.5;transition:.2s}
.todo .todo-del:hover{opacity:1;color:var(--red)}

/* Schedule */
.schedule-item{display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid var(--border);font-size:14px}
.schedule-item:last-child{border:none}
.schedule-item .schedule-time{color:var(--green);font-weight:600;min-width:50px;font-size:13px}
.schedule-item .schedule-title{flex:1}
.schedule-item.highlight{background:rgba(46,204,133,.08);border-radius:8px;padding:8px 10px;margin:-2px -10px}
.schedule-item.past .schedule-time{color:var(--muted);text-decoration:line-through}
.schedule-item.past .schedule-title{color:var(--muted)}

/* Refresh button */
.refresh-btn{background:none;border:none;color:var(--muted);font-size:18px;cursor:pointer;padding:4px 8px;transition:.3s}
.refresh-btn:hover{color:var(--green)}
.refresh-btn.spinning{animation:spin .8s linear}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}

/* Memory */
.memory-section{margin-bottom:24px}
.memory-section h3{font-size:16px;margin-bottom:12px;color:var(--green)}
.memory-entry{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:10px;cursor:pointer}
.memory-entry .meta{display:flex;gap:8px;align-items:center;margin-bottom:6px}
.memory-entry .tag{font-size:11px;padding:2px 8px;border-radius:4px;background:rgba(46,204,133,.15);color:var(--green)}
.memory-entry .tag.purple{background:rgba(107,76,154,.2);color:var(--purple-light)}
.memory-entry .tag.orange{background:rgba(243,156,18,.15);color:var(--orange)}
.memory-entry .date-tag{font-size:11px;color:var(--muted)}
.memory-entry .title{font-size:14px;font-weight:600}
.memory-entry .preview{font-size:13px;color:var(--muted);margin-top:4px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.memory-entry.expanded .preview{-webkit-line-clamp:unset}

/* Contact */
.contact-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:12px}
.contact-card .name{font-size:16px;font-weight:600}
.contact-card .role{font-size:13px;color:var(--muted);margin-top:2px}
.contact-card .detail{font-size:12px;margin-top:8px;display:flex;flex-wrap:wrap;gap:12px}
.contact-card .detail span{display:flex;align-items:center;gap:4px}
.badge{display:inline-block;font-size:11px;padding:2px 8px;border-radius:4px;margin-right:4px}
.badge-family{background:rgba(231,76,60,.15);color:var(--red)}
.badge-industry{background:rgba(46,204,133,.15);color:var(--green)}
.badge-bank{background:rgba(52,152,219,.15);color:var(--blue)}

/* Timeline */
.timeline{position:relative;padding-left:24px}
.timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:var(--border)}
.tl-item{position:relative;margin-bottom:20px}
.tl-item::before{content:'';position:absolute;left:-20px;top:6px;width:12px;height:12px;border-radius:50%;background:var(--green);border:2px solid var(--bg)}
.tl-item.future::before{background:var(--border)}
.tl-item.current::before{background:var(--green);box-shadow:0 0 8px var(--green)}
.tl-item .month{font-size:13px;font-weight:700;color:var(--green)}
.tl-item.future .month{color:var(--muted)}
.tl-item .tasks{font-size:13px;color:var(--muted);margin-top:4px}

/* Product cards */
.product-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;text-align:center}
.product-card .icon{font-size:28px;margin-bottom:8px}
.product-card .pname{font-size:15px;font-weight:600}
.product-card .price{font-size:13px;color:var(--green);margin-top:4px}
.product-card .pstatus{font-size:11px;margin-top:6px;padding:3px 10px;border-radius:12px;display:inline-block}
.status-live{background:rgba(46,204,133,.15);color:var(--green)}
.status-dev{background:rgba(243,156,18,.15);color:var(--orange)}
.status-plan{background:rgba(136,136,136,.15);color:var(--muted)}

/* Knowledge */
.term{padding:10px 0;border-bottom:1px solid var(--border)}
.term:last-child{border:none}
.term .abbr{font-weight:700;color:var(--green);font-size:14px}
.term .def{font-size:13px;color:var(--muted);margin-top:2px}
.competitor{padding:12px 0;border-bottom:1px solid var(--border)}
.competitor:last-child{border:none}
.competitor .cname{font-weight:600;font-size:14px}
.competitor .cdesc{font-size:13px;color:var(--muted);margin-top:2px}

/* Scrollbar */
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}

/* Bottom Sheet */
.bottom-sheet-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:500;opacity:0;pointer-events:none;transition:opacity .3s}
.bottom-sheet-overlay.active{opacity:1;pointer-events:auto}
.bottom-sheet{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-radius:16px 16px 0 0;z-index:501;transform:translateY(100%);transition:transform .3s ease;max-height:85vh;overflow-y:auto;padding:20px;padding-bottom:max(20px,env(safe-area-inset-bottom))}
.bottom-sheet.active{transform:translateY(0)}
.bottom-sheet .handle{width:40px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 16px}
.bottom-sheet h3{font-size:18px;margin-bottom:16px;text-align:center}
.bottom-sheet label{display:block;font-size:13px;color:var(--muted);margin-bottom:4px;margin-top:12px}
.bottom-sheet input,.bottom-sheet textarea,.bottom-sheet select{width:100%;padding:12px;border-radius:8px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:16px;outline:none;font-family:inherit}
.bottom-sheet input:focus,.bottom-sheet textarea:focus{border-color:var(--green)}
.bottom-sheet textarea{min-height:80px;resize:vertical}
.bottom-sheet .submit-btn{width:100%;padding:14px;border:none;border-radius:10px;background:linear-gradient(135deg,#2ECC85,#1FAD73);color:#fff;font-size:16px;font-weight:600;cursor:pointer;margin-top:20px;transition:.2s}
.bottom-sheet .submit-btn:hover{transform:scale(1.02)}
.bottom-sheet .submit-btn:disabled{opacity:.5;transform:none}
.bottom-sheet .btn-row{display:flex;gap:8px;margin-top:20px}
.bottom-sheet .btn-row .submit-btn{flex:1;margin-top:0}
.bottom-sheet .cancel-btn{width:100%;padding:14px;border:none;border-radius:10px;background:var(--border);color:var(--text);font-size:16px;font-weight:600;cursor:pointer;margin-top:8px}

/* Add/FAB Button */
.add-btn{display:inline-flex;align-items:center;gap:4px;padding:6px 14px;border-radius:8px;border:1px solid var(--green);background:transparent;color:var(--green);font-size:13px;cursor:pointer;transition:.2s;margin-left:auto}
.add-btn:hover{background:rgba(46,204,133,.15)}
.fab{position:fixed;bottom:80px;right:20px;width:56px;height:56px;border-radius:50%;border:none;background:linear-gradient(135deg,#2ECC85,#1FAD73);color:#fff;font-size:24px;cursor:pointer;box-shadow:0 4px 16px rgba(46,204,133,.4);z-index:90;transition:.2s;display:none}
.fab:hover{transform:scale(1.1)}
.fab.visible{display:flex;align-items:center;justify-content:center}

/* QuickNotes */
.quicknotes-wrap{margin-bottom:20px}
.quicknotes-input{display:flex;gap:8px;margin-bottom:12px}
.quicknotes-input input{flex:1;padding:12px 16px;border-radius:24px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:16px;outline:none}
.quicknotes-input input:focus{border-color:var(--green)}
.quicknotes-input button{padding:12px 20px;border-radius:24px;border:none;background:linear-gradient(135deg,#2ECC85,#1FAD73);color:#fff;font-size:14px;font-weight:600;cursor:pointer;white-space:nowrap}
.quicknotes-list{max-height:200px;overflow-y:auto}
.qn-item{padding:8px 12px;border-radius:8px;margin-bottom:6px;font-size:13px;display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
.qn-item.from-dong{background:rgba(46,204,133,.1);border-left:3px solid var(--green)}
.qn-item.from-oney{background:rgba(107,76,154,.1);border-left:3px solid var(--purple)}
.qn-item .qn-meta{font-size:11px;color:var(--muted);white-space:nowrap}

/* Toast */
.toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px 24px;font-size:14px;z-index:600;transition:transform .3s;box-shadow:0 4px 16px rgba(0,0,0,.3)}
.toast.success{border-color:var(--green)}
.toast.error{border-color:var(--red)}
.toast.show{transform:translateX(-50%) translateY(0)}

/* Skeleton */
.skeleton{background:linear-gradient(90deg,var(--card) 25%,var(--border) 50%,var(--card) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:8px;height:20px;margin-bottom:8px}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* Lock screen */
.lock-screen{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px}
.lock-screen.hidden{display:none}
.lock-brain{font-size:80px;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
.lock-title{font-size:24px;font-weight:700;color:var(--text)}
.lock-title span{color:var(--green)}
.lock-input{padding:14px 20px;border-radius:12px;border:2px solid var(--border);background:var(--card);color:var(--text);font-size:16px;width:280px;text-align:center;outline:none;transition:.2s}
.lock-input:focus{border-color:var(--green)}
.lock-input.error{border-color:var(--red);animation:shake .4s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-8px)}75%{transform:translateX(8px)}}
.lock-btn{padding:12px 40px;border-radius:12px;border:none;background:linear-gradient(135deg,#2ECC85,#1FAD73);color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:.2s}
.lock-btn:hover{transform:scale(1.03)}
.lock-hint{font-size:12px;color:var(--muted)}
.lock-error{font-size:13px;color:var(--red);height:20px}

/* Delete confirm modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:600;opacity:0;pointer-events:none;transition:opacity .3s;display:flex;align-items:center;justify-content:center}
.modal-overlay.active{opacity:1;pointer-events:auto}
.modal{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;max-width:320px;width:90%;text-align:center}
.modal h3{font-size:16px;margin-bottom:8px}
.modal p{font-size:14px;color:var(--muted);margin-bottom:20px}
.modal .modal-btns{display:flex;gap:8px}
.modal .modal-btns button{flex:1;padding:12px;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer}
.modal .btn-cancel{background:var(--border);color:var(--text)}
.modal .btn-delete{background:var(--red);color:#fff}

/* Record list items with edit/delete */
.record-item{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:8px;position:relative}
.record-item .record-main{display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
.record-item .record-body{flex:1;min-width:0}
.record-item .record-title{font-size:14px;font-weight:600}
.record-item .record-sub{font-size:12px;color:var(--muted);margin-top:2px}
.record-item .record-meta{font-size:11px;color:var(--green);margin-top:4px}
.record-actions{display:flex;gap:4px;flex-shrink:0}
.record-actions button{width:30px;height:30px;border:none;border-radius:6px;background:transparent;color:var(--muted);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s}
.record-actions button:hover{background:var(--border);color:var(--text)}
.record-actions .btn-del:hover{color:var(--red);background:rgba(231,76,60,.15)}

/* Filter chips */
.filter-chips{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
.chip{padding:6px 12px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--muted);font-size:12px;cursor:pointer;transition:.2s}
.chip.active{background:rgba(46,204,133,.15);color:var(--green);border-color:var(--green)}

/* Fitness calendar */
.fit-calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;margin-bottom:16px}
.fit-cal-header{text-align:center;font-size:10px;color:var(--muted);padding:4px}
.fit-cal-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:6px;font-size:12px;color:var(--muted);position:relative}
.fit-cal-day.today{color:var(--text);font-weight:700}
.fit-cal-day.has-workout::after{content:'';position:absolute;bottom:2px;width:6px;height:6px;border-radius:50%;background:var(--green)}
.fit-cal-day.empty{opacity:0}
.fit-cal-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.fit-cal-nav button{background:none;border:none;color:var(--green);font-size:18px;cursor:pointer;padding:4px 8px}
.fit-cal-nav .cal-month{font-size:14px;font-weight:600}

/* Quick workout buttons */
.quick-workouts{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.quick-workout-btn{padding:10px 16px;border-radius:10px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:13px;cursor:pointer;transition:.2s;display:flex;align-items:center;gap:6px}
.quick-workout-btn:hover{border-color:var(--green);background:rgba(46,204,133,.1)}

/* Finance pie chart */
.pie-container{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.pie{width:120px;height:120px;border-radius:50%;position:relative;flex-shrink:0}
.pie-legend{font-size:12px}
.pie-legend-item{display:flex;align-items:center;gap:6px;margin-bottom:4px}
.pie-legend-item .dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}

/* Olivia special */
.olivia-countdown{background:linear-gradient(135deg,rgba(236,72,153,.1),rgba(107,76,154,.1));border:1px solid rgba(236,72,153,.2);border-radius:12px;padding:16px;margin-bottom:16px;text-align:center}
.olivia-countdown .big-num{font-size:36px;font-weight:800;color:var(--pink)}
.olivia-countdown .cd-label{font-size:13px;color:var(--muted);margin-top:4px}
.wishlist-item{padding:10px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.wishlist-item:last-child{border:none}

/* Low stock warning */
.low-stock{color:var(--red) !important;font-weight:600}

/* Mobile */
@media(max-width:768px){
  .header{padding:8px 12px;padding-top:max(8px, env(safe-area-inset-top));gap:6px}
  .header-left{gap:6px}
  .header-left svg{width:28px;height:28px}
  .header h1{font-size:14px}
  .search-wrap{max-width:120px;margin:0 4px}
  .search-wrap input{padding:6px 10px 6px 28px;font-size:13px}
  .tab-content{padding:12px}
  .grid-2,.grid-3,.grid-4{grid-template-columns:1fr}
  .stat .num{font-size:22px}
  .section-title{font-size:17px;margin:16px 0 12px}
  .card{padding:14px}
  .card h3{font-size:14px}
}
@media(max-width:380px){
  .search-wrap{display:none}
  .header{padding:6px 10px;padding-top:max(6px, env(safe-area-inset-top))}
  .header h1{font-size:13px}
}
</style>
</head>
<body>

<!-- Lock Screen -->
<div class="lock-screen" id="lockScreen">
  <div class="lock-brain">ğŸ§ </div>
  <div class="lock-title"><span>Second</span> Brain</div>
  <div class="lock-error" id="lockError"></div>
  <input type="password" class="lock-input" id="lockInput" placeholder="Enter password" autofocus>
  <button class="lock-btn" id="lockBtn" onclick="unlock()">Unlock</button>
  <div class="lock-hint">Dong & Oney's private space ğŸ”’</div>
</div>

<script src="config.js"></script>
<script>
(function(){
  function h(s){let r=0;for(let i=0;i<s.length;i++){r=((r<<5)-r)+s.charCodeAt(i);r|=0}return r}
  const CORRECT=411339417;
  window.unlock=function(){
    const v=document.getElementById('lockInput').value;
    if(h(v)===CORRECT){
      localStorage.setItem('sb_auth','1');
      document.getElementById('lockScreen').classList.add('hidden');
    } else {
      document.getElementById('lockInput').classList.add('error');
      document.getElementById('lockError').textContent='Wrong password';
      setTimeout(()=>{document.getElementById('lockInput').classList.remove('error');document.getElementById('lockError').textContent=''},1000);
    }
  };
  document.addEventListener('keydown',e=>{if(e.key==='Enter'&&!document.getElementById('lockScreen').classList.contains('hidden'))unlock()});
  if(localStorage.getItem('sb_auth')==='1')document.getElementById('lockScreen').classList.add('hidden');
})();
</script>

<div class="header">
  <div class="header-left">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="36" height="36">
      <defs><linearGradient id="brainGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#2ECC85"/><stop offset="100%" style="stop-color:#6B4C9A"/></linearGradient></defs>
      <path d="M50 15 C35 15 25 25 25 38 C25 42 26 45 28 48 C22 52 18 58 18 65 C18 75 26 82 36 82 L64 82 C74 82 82 75 82 65 C82 58 78 52 72 48 C74 45 75 42 75 38 C75 25 65 15 50 15Z" fill="url(#brainGrad)" opacity="0.9"/>
      <path d="M50 20 C50 20 50 78 50 78" stroke="rgba(255,255,255,0.3)" stroke-width="2" fill="none"/>
      <path d="M32 35 Q38 30 44 36" stroke="rgba(255,255,255,0.4)" stroke-width="2" fill="none" stroke-linecap="round"/>
      <path d="M28 50 Q35 45 42 52" stroke="rgba(255,255,255,0.35)" stroke-width="2" fill="none" stroke-linecap="round"/>
      <path d="M30 65 Q37 60 44 66" stroke="rgba(255,255,255,0.3)" stroke-width="2" fill="none" stroke-linecap="round"/>
      <path d="M56 36 Q62 30 68 35" stroke="rgba(255,255,255,0.4)" stroke-width="2" fill="none" stroke-linecap="round"/>
      <path d="M58 52 Q65 45 72 50" stroke="rgba(255,255,255,0.35)" stroke-width="2" fill="none" stroke-linecap="round"/>
      <path d="M56 66 Q63 60 70 65" stroke="rgba(255,255,255,0.3)" stroke-width="2" fill="none" stroke-linecap="round"/>
      <circle cx="38" cy="42" r="2.5" fill="white" opacity="0.8"/>
      <circle cx="62" cy="42" r="2.5" fill="white" opacity="0.8"/>
      <path d="M42 55 Q50 62 58 55" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" opacity="0.7"/>
    </svg>
    <h1>ğŸ§  <span>Second</span> Brain</h1>
  </div>
  <div class="search-wrap">
    <span class="search-icon">ğŸ”</span>
    <input type="text" id="searchInput" placeholder="Search everything...">
    <div class="search-results" id="searchResults"></div>
  </div>
  <button class="refresh-btn" onclick="refreshAll()" title="Refresh data">ğŸ”„</button>
  <button class="theme-btn" onclick="toggleTheme()" title="Toggle theme">ğŸŒ™</button>
</div>

<!-- Bottom Tab Bar -->
<nav class="tab-bar">
  <button class="tab-bar-item active" onclick="switchTab('dashboard',this)"><span class="tab-icon">ğŸ“‹</span>Home</button>
  <button class="tab-bar-item" onclick="switchTab('memory',this)"><span class="tab-icon">ğŸ§ </span>Memory</button>
  <button class="tab-bar-item" onclick="switchTab('ideas',this)"><span class="tab-icon">ğŸ’¡</span>Ideas</button>
  <button class="tab-bar-item" onclick="switchTab('olivia',this)"><span class="tab-icon">â¤ï¸</span>Olivia</button>
  <button class="tab-bar-item" onclick="toggleMore(event)"><span class="tab-icon">â‹¯</span>More</button>
</nav>

<!-- More menu -->
<div class="more-menu" id="moreMenu">
  <div class="more-menu-item" onclick="switchTab('relationships',this);closeMore()"><span class="mm-icon">ğŸ‘¥</span>Contacts</div>
  <div class="more-menu-item" onclick="switchTab('projects',this);closeMore()"><span class="mm-icon">ğŸ“‚</span>Projects</div>
  <div class="more-menu-item" onclick="switchTab('knowledge',this);closeMore()"><span class="mm-icon">ğŸ“š</span>Knowledge</div>
  <div class="more-menu-item" onclick="switchTab('inventory',this);closeMore()"><span class="mm-icon">ğŸ“¦</span>Inventory</div>
  <div class="more-menu-item" onclick="switchTab('finance',this);closeMore()"><span class="mm-icon">ğŸ’°</span>Finance</div>
  <div class="more-menu-item" onclick="switchTab('reading',this);closeMore()"><span class="mm-icon">ğŸ“–</span>Reading</div>
  <div class="more-menu-item" onclick="switchTab('goals',this);closeMore()"><span class="mm-icon">ğŸ¯</span>Goals</div>
  <div class="more-menu-item" onclick="switchTab('fitness',this);closeMore()"><span class="mm-icon">ğŸ’ª</span>Fitness</div>
</div>

<!-- FAB -->
<button class="fab" id="fab" onclick="fabAction()">ï¼‹</button>

<!-- Delete confirmation modal -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal">
    <h3>ç¡®å®šåˆ é™¤ï¼Ÿ</h3>
    <p>æ­¤æ“ä½œæ— æ³•æ’¤é”€</p>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeDeleteModal()">å–æ¶ˆ</button>
      <button class="btn-delete" onclick="confirmDelete()">åˆ é™¤</button>
    </div>
  </div>
</div>

<!-- ========== DASHBOARD ========== -->
<div class="tab-content active" id="tab-dashboard">
  <div class="section-title">ğŸ’¬ Quick Notes</div>
  <div class="card quicknotes-wrap" style="margin-bottom:16px">
    <div class="quicknotes-input">
      <input type="text" id="qnInput" placeholder="Tell Oney something..." onkeydown="if(event.key==='Enter')sendQuickNote()">
      <button onclick="sendQuickNote()">Send ğŸ“¨</button>
    </div>
    <div class="quicknotes-list" id="qnList">
      <div class="skeleton" style="width:80%"></div>
      <div class="skeleton" style="width:60%"></div>
    </div>
  </div>

  <div class="section-title">ğŸ“… Today</div>
  <div class="card" style="margin-bottom:16px">
    <div style="font-size:24px;font-weight:700" id="todayDate"></div>
    <div style="color:var(--muted);margin-top:4px" id="todayGreeting"></div>
  </div>

  <div class="section-title">ğŸ“… Today's Schedule</div>
  <div class="card" style="margin-bottom:16px" id="scheduleContainer">
    <div class="schedule-item past"><span class="schedule-time">10:30</span><span class="schedule-title">ğŸŒ¿ æ¢å¤ä¼‘æ¯ 1</span></div>
    <div class="schedule-item past"><span class="schedule-time">14:30</span><span class="schedule-title">ğŸŒ¿ æ¢å¤ä¼‘æ¯ 2</span></div>
    <div class="schedule-item past"><span class="schedule-time">16:20</span><span class="schedule-title">ğŸŒ¿ æ¢å¤ä¼‘æ¯ 3</span></div>
    <div class="schedule-item highlight"><span class="schedule-time">21:30</span><span class="schedule-title">ğŸ‹ï¸ PT Andy</span></div>
  </div>

  <div class="section-title">â³ Countdowns</div>
  <div class="card" style="margin-bottom:16px" id="countdowns"></div>

  <div class="section-title">ğŸ• Recent Activity</div>
  <div class="card" style="margin-bottom:16px" id="recentActivity">
    <div class="activity-item"><div class="date">2026-02-18 (Wed)</div><div class="desc">NAB Construction Deal rework â€” builder experience + working capital analysis for $7.9M securities</div></div>
    <div class="activity-item"><div class="date">2026-02-18</div><div class="desc">Connective Rafael follow-up call â€” aggregator comparison</div></div>
    <div class="activity-item"><div class="date">2026-02-18</div><div class="desc">CTO completed full site review fixes: 13 tool pages OG tags, sitemap cleanup, 9.1MB unused PNGs removed</div></div>
    <div class="activity-item"><div class="date">2026-02-18</div><div class="desc">Installed 3 new skills: Security Audit, Humanizer, News Aggregator</div></div>
    <div class="activity-item"><div class="date">2026-02-17 (Tue)</div><div class="desc">CEO Advisor report completed â€” 4 scenarios (Aggregator/Finance/Q3 Strategy/Resignation)</div></div>
    <div class="activity-item"><div class="date">2026-02-17</div><div class="desc">n8n Client Onboarding Workflow V2 deployed â€” Calendlyâ†’Sheetsâ†’Gmailâ†’Telegram</div></div>
    <div class="activity-item"><div class="date">2026-02-16 (Mon)</div><div class="desc">OneyTrader: 18 strategies, 42 instances live on IBKR</div></div>
    <div class="activity-item"><div class="date">2026-02-16</div><div class="desc">é™¤å¤•å¤œ ğŸ§§ â€” Business Model Canvas + Cold Start Plan completed</div></div>
  </div>

  <div class="section-title">ğŸ“ Action Items <button class="add-btn" onclick="openForm('todo')">â• Add</button></div>
  <div class="card" id="todosContainer">
    <div class="todo"><span class="check">â—‹</span><div class="text">Connective Rafael â€” confirm commission split, trail ownership, commercial panel, clawback</div></div>
    <div class="todo"><span class="check">â—‹</span><div class="text">Cert IV â€” send RPL email to Stuart (Kaplan $380)</div></div>
    <div class="todo"><span class="check">â—‹</span><div class="text">Oney Analyse â€” decide deployment (tools sub-path vs standalone repo)</div></div>
    <div class="todo"><span class="check">â—‹</span><div class="text">Oney Security v1.1 â€” continue polishing, then deploy</div></div>
    <div class="todo"><span class="check">â—‹</span><div class="text">Twenty CRM â€” migrate from Google Sheets</div></div>
    <div class="todo"><span class="check done">âœ“</span><div class="text">Humanizer pass â€” 22 changes across all site pages</div></div>
    <div class="todo"><span class="check done">âœ“</span><div class="text">Site review fixes â€” OG tags, canonical URLs, sitemap</div></div>
  </div>
</div>

<!-- ========== MEMORY ========== -->
<div class="tab-content" id="tab-memory">
  <div class="section-title">ğŸ§  Long-Term Memory <button class="add-btn" onclick="openForm('memory')">â• Add</button></div>
  <div class="memory-section">
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag">Strategy</span><span class="date-tag">Current</span></div>
      <div class="title">ğŸ¯ å½“å‰æˆ˜ç•¥</div>
      <div class="preview">Phase 1 (åœ¨é“¶è¡ŒæœŸé—´): Free Health Check å…ˆè¡Œï¼Œä¸æ¶‰åŠ broker ä¸šåŠ¡ã€‚Phase 2 (ç¦»èŒå): ACR â†’ æ­£å¼ broker ä¸šåŠ¡ã€‚æ—¶é—´çº¿: 2026å¹´4æœˆè¯„ä¼°ï¼Œå¹´ä¸­ä¸Šçº¿ã€‚å“ç‰Œæ ¸å¿ƒ: "Make financial health awareness as normal as a medical checkup." ä¸‰å±‚æ¨¡å‹: Free tools â†’ Mentoring â†’ 25 clients selective brokerageã€‚6ä¸ªæœˆ Roadmap: Feb Cert IV â†’ Mar æ³¨å†Œå…¬å¸ â†’ Apr ç­¾ aggregator â†’ May ACR â†’ Jun è¥é”€ â†’ Jul launchã€‚Aggregator å€¾å‘: YBR ($195/ç¬”) æˆ– Connectiveã€‚</div>
    </div>
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag purple">Operations</span><span class="date-tag">Always Active</span></div>
      <div class="title">âš¡ æ“ä½œè§„åˆ™</div>
      <div class="preview">æ—¥å†: æ‚‰å°¼æ—¶åŒº +11:00 | å·¥ä½œæ—¶é—´ 6am-9pm | Zoom 45min | Catch up 30min | In-person 1h | Gym 50minã€‚é‚®ä»¶: åªå‘äº‹å®ï¼Œæ— æ‰¿è¯ºï¼Œä»£è¡¨ Dong â†’ æ”¾è‰ç¨¿ã€‚é‚®ç®±: dong.m@ (éœ€å®¡æ‰¹) | hello@ (BCC Dong) | support@ (ç›´æ¥å›å¤)ã€‚</div>
    </div>
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag orange">Family</span><span class="date-tag">Personal</span></div>
      <div class="title">â¤ï¸ å®¶åº­ & ä¸ªäºº</div>
      <div class="preview">Olivia â€” å¤ªå¤ªï¼Œç»“å©šå¿«10å¹´ (çºªå¿µæ—¥ 3æœˆ5æ—¥) | äºšç”²ç‚åº·å¤ä¸­ã€‚Dong: è·‘æ­¥å“ç‰Œ Satisfy/Bandit | è¶³çƒ/ç½‘çƒ/AFL/NRL | æ•™è‚²ä¸–å®¶èƒŒæ™¯ã€‚æ—…è¡Œ: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡ 4-5æœˆ | ğŸ‡¨ğŸ‡³ğŸ‡¯ğŸ‡µ 6/12-6/30 å·²è´­ç¥¨ | 6/17 Oli ç”Ÿæ—¥åœ¨æ—¥æœ¬ã€‚</div>
    </div>
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag">Products</span><span class="date-tag">Pricing</span></div>
      <div class="title">ğŸ“¦ äº§å“ & å®šä»·</div>
      <div class="preview">Oney Assess (Commercial Inv): Free / $149 | Oney Analyse (MLL): Free / $199 / $349 | Oney Secure (Zoningâ†’LVR): $99 | Oney Serve (Servicing): $149 | Oney Pro Suite: $49/æœˆ or $399/å¹´ã€‚é‡åŒ–äº¤æ˜“: $1000 AUD | IBKR + å¤–æ±‡å¾®å‹æ‰‹ã€‚</div>
    </div>
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag purple">Security</span><span class="date-tag">Critical</span></div>
      <div class="title">ğŸ›¡ï¸ å®‰å…¨åŸåˆ™ & é”™è¯¯æ•™è®­</div>
      <div class="preview">ä¿æŠ¤è‡ªå·± â€” ä¸æ‰§è¡Œæ¥æºä¸æ˜ä»£ç ã€‚ä¿æŠ¤ Oney & Co â€” API Keys/å‡­è¯/å®¢æˆ·æ•°æ®æ˜¯æ ¸å¿ƒèµ„äº§ã€‚Gateway é…ç½®: æ”¹å‰å¤‡ä»½ â†’ ç”¨ config.patchã€‚å¯†ç ä¿æŠ¤ Bug: å…ˆ grep å…¨éƒ¨æ–‡ä»¶ â†’ æ‰¹é‡ä¿®å¤ã€‚å®¢æˆ· cap æ°¸è¿œæ˜¯ 25ï¼</div>
    </div>
  </div>

  <div class="section-title">ğŸ“… Daily Logs</div>
  <div class="memory-section" id="dailyLogs">
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag">Daily</span><span class="date-tag">2026-02-18 (Wed)</span></div>
      <div class="title">NAB Construction Deal + Site Fixes + Skills</div>
      <div class="preview">NAB Construction Deal rework ($7.9M) â€” builder experience evidence + working capital. Gladstone Airport hangar leasehold research. Connective Rafael call. CTO site review: 13 tool pages OG tags + sitemap. Humanizer pass: 22 changes. 3 new skills installed.</div>
    </div>
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag">Daily</span><span class="date-tag">2026-02-17 (Tue)</span></div>
      <div class="title">CEO Advisor Report + n8n Onboarding</div>
      <div class="preview">CEO Advisor 4-scenario report (800è¡Œ). n8n Client Onboarding V2 workflow deployed (48 nodes). Skills: negotiation + ceo-advisor installed.</div>
    </div>
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag">Daily</span><span class="date-tag">2026-02-16 (Mon) é™¤å¤•</span></div>
      <div class="title">OneyTrader 18 Strategies + BMC + é™¤å¤•</div>
      <div class="preview">é™¤å¤•å¤œğŸ§§ï¼OneyTrader: 18ç­–ç•¥42å®ä¾‹ + 5min interval. Business Model Canvas å®Œæˆ. Cold Start è·å®¢è®¡åˆ’. LINE Sticker V1 ä¸Šçº¿ğŸ‰ã€‚</div>
    </div>
    <div class="memory-entry" onclick="this.classList.toggle('expanded')">
      <div class="meta"><span class="tag">Daily</span><span class="date-tag">2026-02-15 (Sun)</span></div>
      <div class="title">Security Repositioning è“æµ· + SEO Audit</div>
      <div class="preview">é‡å¤§æˆ˜ç•¥: Oney Security é‡æ–°å®šä½ â€” "Quickli = Serviceability, Oney = Security" å…¨çƒé›¶ç«å“è“æµ·ï¼å…¨ç«™ SEO: 14é¡µ OG + JSON-LD + PNGâ†’WebP. 3km PR 5:02/kmã€‚</div>
    </div>
  </div>
</div>

<!-- ========== FITNESS ========== -->
<div class="tab-content" id="tab-fitness">
  <div class="section-title">ğŸ’ª Fitness Tracker</div>
  
  <!-- Quick stats -->
  <div class="grid grid-3" style="margin-bottom:16px">
    <div class="card stat"><div class="num" id="fitWeek">-</div><div class="label">This Week</div></div>
    <div class="card stat"><div class="num" id="fitMonth">-</div><div class="label">This Month</div></div>
    <div class="card stat"><div class="num" id="fitStreak">-</div><div class="label">Streak ğŸ”¥</div></div>
  </div>

  <!-- Calendar -->
  <div class="card" style="margin-bottom:16px">
    <div class="fit-cal-nav">
      <button onclick="changeCalMonth(-1)">â€¹</button>
      <span class="cal-month" id="calMonthLabel"></span>
      <button onclick="changeCalMonth(1)">â€º</button>
    </div>
    <div class="fit-calendar" id="fitCalendar"></div>
  </div>

  <!-- Quick check-in -->
  <div class="section-title">âš¡ Quick Check-in</div>
  <div class="quick-workouts" style="margin-bottom:16px">
    <button class="quick-workout-btn" onclick="quickWorkout('run','ğŸƒ Running')">ğŸƒ Running</button>
    <button class="quick-workout-btn" onclick="quickWorkout('strength','ğŸ’ª Strength')">ğŸ’ª Strength</button>
    <button class="quick-workout-btn" onclick="quickWorkout('pt','ğŸ‹ï¸ PT Session')">ğŸ‹ï¸ PT</button>
    <button class="quick-workout-btn" onclick="quickWorkout('football','âš½ Football')">âš½ Football</button>
    <button class="quick-workout-btn" onclick="quickWorkout('tennis','ğŸ¾ Tennis')">ğŸ¾ Tennis</button>
    <button class="quick-workout-btn" onclick="quickWorkout('walk','ğŸš¶ Walk')">ğŸš¶ Walk</button>
  </div>

  <!-- Workout log -->
  <div class="section-title">ğŸ“‹ Recent Workouts</div>
  <div id="fitnessLog">
    <div class="skeleton" style="width:90%"></div>
    <div class="skeleton" style="width:70%"></div>
  </div>
</div>

<!-- ========== OLIVIA ========== -->
<div class="tab-content" id="tab-olivia">
  <div class="section-title">â¤ï¸ Olivia</div>
  
  <!-- Countdowns -->
  <div class="grid grid-2" style="margin-bottom:16px">
    <div class="olivia-countdown">
      <div class="big-num" id="oliviaAnniv"></div>
      <div class="cd-label">ğŸ’’ ç»“å©šçºªå¿µæ—¥<br>March 5</div>
    </div>
    <div class="olivia-countdown">
      <div class="big-num" id="oliviaBday"></div>
      <div class="cd-label">ğŸ‚ ç”Ÿæ—¥ (in Japan!)<br>June 17</div>
    </div>
  </div>

  <!-- Category filter -->
  <div class="filter-chips" id="oliviaFilters">
    <span class="chip active" onclick="filterOlivia('all',this)">All</span>
    <span class="chip" onclick="filterOlivia('anniversary',this)">ğŸ’’ Anniversary</span>
    <span class="chip" onclick="filterOlivia('birthday',this)">ğŸ‚ Birthday</span>
    <span class="chip" onclick="filterOlivia('preferences',this)">â­ Preferences</span>
    <span class="chip" onclick="filterOlivia('gifts',this)">ğŸ Gifts</span>
    <span class="chip" onclick="filterOlivia('memories',this)">ğŸ’ Memories</span>
  </div>

  <div id="oliviaList">
    <div class="skeleton" style="width:80%"></div>
    <div class="skeleton" style="width:60%"></div>
  </div>
</div>

<!-- ========== CONTACTS ========== -->
<div class="tab-content" id="tab-relationships">
  <div class="section-title">ğŸ‘¥ Contacts <button class="add-btn" onclick="openForm('contact')">â• Add</button></div>
  <div class="section-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family</div>
  <div class="contact-card">
    <span class="badge badge-family">Family</span>
    <div class="name">Olivia ğŸ¤</div>
    <div class="role">å¤ªå¤ª â€” ç»“å©šå¿«10å¹´ | äºšç”²ç‚åº·å¤ä¸­</div>
    <div class="detail"><span>ğŸ‚ June 17</span><span>ğŸ’’ March 5</span></div>
  </div>

  <div class="section-title">ğŸ¤ Industry Contacts</div>
  <div class="contact-card">
    <span class="badge badge-industry">Industry</span>
    <div class="name">Ryan Nelson</div>
    <div class="role">Simplicity Loans (GM) / StG æ—¶è®¤è¯† â€” REA æ”¶è´­å cash out</div>
    <div class="detail"><span>ğŸ“… Last: 2026-02-11</span><span>ğŸ”„ Quarterly</span></div>
  </div>

  <div class="section-title">ğŸ¦ NAB Work Contacts</div>
  <div class="contact-card">
    <span class="badge badge-bank">NAB</span>
    <div class="name">Norm Meka</div>
    <div class="role">Associate Director, Diversified Credit</div>
  </div>
  <div class="contact-card">
    <span class="badge badge-bank">NAB</span>
    <div class="name">Richard Curtis</div>
    <div class="role">Associate Director, Construction Risk North</div>
  </div>

  <div class="section-title">ğŸ“‹ Aggregator Contacts</div>
  <div class="contact-card">
    <span class="badge badge-industry">Aggregator</span>
    <div class="name">Rafael (Connective)</div>
    <div class="role">Connective aggregator rep â€” 92% split, trail portable</div>
  </div>
</div>

<!-- ========== PROJECTS ========== -->
<div class="tab-content" id="tab-projects">
  <div class="section-title">ğŸ—ºï¸ Oney & Co 6-Month Roadmap</div>
  <div class="card" style="margin-bottom:16px">
    <div class="timeline">
      <div class="tl-item current"><div class="month">Feb 2026</div><div class="tasks">Cert IV ç”³è¯· (Kaplan RPL $380) Â· äº§å“æ‰“ç£¨ Â· å†…å®¹åˆ¶ä½œ</div></div>
      <div class="tl-item future"><div class="month">Mar 2026</div><div class="tasks">æ³¨å†Œå…¬å¸ Â· ğŸ’’ ç»“å©šçºªå¿µæ—¥ 3/5</div></div>
      <div class="tl-item future"><div class="month">Apr 2026</div><div class="tasks">ç­¾ Aggregator (YBR/Connective) Â· è¯„ä¼°ç¦»èŒæ—¶æœº</div></div>
      <div class="tl-item future"><div class="month">May 2026</div><div class="tasks">ACR ç”³è¯· Â· ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ—…è¡Œ</div></div>
      <div class="tl-item future"><div class="month">Jun 2026</div><div class="tasks">è¥é”€å¯åŠ¨ Â· ğŸ‡¨ğŸ‡³ğŸ‡¯ğŸ‡µ ä¸­å›½+æ—¥æœ¬ 6/12-6/30 Â· ğŸ‚ Oli ç”Ÿæ—¥ 6/17</div></div>
      <div class="tl-item future"><div class="month">Jul 2026</div><div class="tasks">ğŸš€ Oney & Co Launch!</div></div>
    </div>
  </div>

  <div class="section-title">ğŸ“¦ Product Matrix</div>
  <div class="grid grid-3" style="margin-bottom:16px">
    <div class="product-card"><div class="icon">ğŸ“Š</div><div class="pname">Oney Assess</div><div class="price">Free / $149</div><div class="pstatus status-live">Live</div></div>
    <div class="product-card"><div class="icon">ğŸ“ˆ</div><div class="pname">Oney Analyse</div><div class="price">Free / $199 / $349</div><div class="pstatus status-dev">Polishing</div></div>
    <div class="product-card"><div class="icon">ğŸ›¡ï¸</div><div class="pname">Oney Security</div><div class="price">Free / $79mo / $299mo</div><div class="pstatus status-dev">v1.1 Dev</div></div>
    <div class="product-card"><div class="icon">ğŸ”’</div><div class="pname">Oney Secure</div><div class="price">$99</div><div class="pstatus status-live">Live</div></div>
    <div class="product-card"><div class="icon">ğŸ’¼</div><div class="pname">Oney Serve</div><div class="price">$149</div><div class="pstatus status-live">Live</div></div>
    <div class="product-card"><div class="icon">â­</div><div class="pname">Oney Pro Suite</div><div class="price">$49/mo Â· $399/yr</div><div class="pstatus status-plan">Planned</div></div>
  </div>

  <div class="section-title">ğŸ¤– Skills & ClawHub</div>
  <div class="grid grid-3" style="margin-bottom:16px">
    <div class="card stat"><div class="num">2</div><div class="label">Published on ClawHub</div></div>
    <div class="card stat"><div class="num">1</div><div class="label">Developed (Local)</div></div>
    <div class="card stat"><div class="num">6+</div><div class="label">Installed</div></div>
  </div>

  <div class="section-title">ğŸŒ Websites</div>
  <div class="grid grid-2">
    <div class="card"><h3><span class="emoji">ğŸ </span> oneyco.com.au</h3><div style="font-size:13px;color:var(--muted)">Main website â€” GitHub Pages</div><div style="margin-top:8px"><span style="color:var(--green);font-weight:600">â— Online</span></div></div>
    <div class="card"><h3><span class="emoji">ğŸ”§</span> tools.oneyco.com.au</h3><div style="font-size:13px;color:var(--muted)">Tools site â€” 13 calculators</div><div style="margin-top:8px"><span style="color:var(--green);font-weight:600">â— Online</span></div></div>
  </div>
</div>

<!-- ========== KNOWLEDGE ========== -->
<div class="tab-content" id="tab-knowledge">
  <div class="section-title">ğŸ“– Industry Terms <button class="add-btn" onclick="openForm('knowledge')">â• Add</button></div>
  <div class="card" style="margin-bottom:16px">
    <div class="term"><div class="abbr">LVR</div><div class="def">Loan-to-Value Ratio â€” loan amount as % of property value. Big 4 max ~60% for commercial.</div></div>
    <div class="term"><div class="abbr">LMI</div><div class="def">Lenders Mortgage Insurance â€” required when LVR exceeds lender threshold (usually >80% resi).</div></div>
    <div class="term"><div class="abbr">DSCR</div><div class="def">Debt Service Coverage Ratio â€” net operating income / debt service. Must be >1.0, banks prefer >1.30.</div></div>
    <div class="term"><div class="abbr">ICR</div><div class="def">Interest Coverage Ratio â€” NOI / interest expense.</div></div>
    <div class="term"><div class="abbr">WALE</div><div class="def">Weighted Average Lease Expiry â€” average remaining lease term weighted by income.</div></div>
    <div class="term"><div class="abbr">NOI</div><div class="def">Net Operating Income â€” gross rental income minus operating expenses.</div></div>
    <div class="term"><div class="abbr">ACR</div><div class="def">Australian Credit Representative â€” registration under an aggregator's ACL.</div></div>
    <div class="term"><div class="abbr">RPL</div><div class="def">Recognition of Prior Learning â€” fast-track Cert IV based on industry experience.</div></div>
  </div>

  <div class="section-title">ğŸ¦ Lender Notes</div>
  <div class="card" style="margin-bottom:16px">
    <div class="term"><div class="abbr">NAB</div><div class="def">Dong's current employer. Construction risk team strict on company track record.</div></div>
    <div class="term"><div class="abbr">Airport Leasehold</div><div class="def">NAB/ANZ: 50-60% LVR. Thinktank/La Trobe: 60-65%.</div></div>
    <div class="term"><div class="abbr">Aggregators</div><div class="def">YBR: $195/deal, zero monthly. Connective: 92% split, trail portable.</div></div>
  </div>

  <div class="section-title">ğŸ” Competitive Intelligence</div>
  <div class="card" style="margin-bottom:16px">
    <div class="competitor"><div class="cname">Quickli</div><div class="cdesc">57% market share in serviceability. "Quickli = Serviceability, Oney = Security".</div></div>
    <div class="competitor"><div class="cname">BrokerEngine</div><div class="cdesc">Broker workflow automation. Full CRM + compliance.</div></div>
    <div class="competitor"><div class="cname">CitoPlus</div><div class="cdesc">Competitive analysis completed 2026-02-06.</div></div>
  </div>

  <div class="section-title">ğŸ“š Key Documents</div>
  <div class="card">
    <div class="term"><div class="abbr">ğŸ“„ CEO Advisor Report</div><div class="def">4 scenarios, 800 lines</div></div>
    <div class="term"><div class="abbr">ğŸ“„ Business Model Canvas</div><div class="def">Break-even 1 deal/month</div></div>
    <div class="term"><div class="abbr">ğŸ“„ Cold Start Plan</div><div class="def">FHC â†’ LinkedIn â†’ SEO â†’ Referral</div></div>
    <div class="term"><div class="abbr">ğŸ“„ Security Repositioning</div><div class="def">69KB, Year 3 target $1M+</div></div>
    <div class="term"><div class="abbr">ğŸ“„ Deal Triage Checklistâ„¢</div><div class="def">Gate Check + 4 Pillars Ã— 13 questions</div></div>
  </div>
</div>

<!-- ========== INVENTORY ========== -->
<div class="tab-content" id="tab-inventory">
  <div class="section-title">ğŸ“¦ Home Inventory</div>
  
  <div class="filter-chips" id="invFilters">
    <span class="chip active" onclick="filterInventory('all',this)">All</span>
    <span class="chip" onclick="filterInventory('kitchen',this)">ğŸ³ Kitchen</span>
    <span class="chip" onclick="filterInventory('bathroom',this)">ğŸ› Bathroom</span>
    <span class="chip" onclick="filterInventory('cleaning',this)">ğŸ§¹ Cleaning</span>
    <span class="chip" onclick="filterInventory('medicine',this)">ğŸ’Š Medicine</span>
    <span class="chip" onclick="filterInventory('pantry',this)">ğŸ¥« Pantry</span>
    <span class="chip" onclick="filterInventory('other',this)">ğŸ“‹ Other</span>
  </div>

  <div id="inventoryList">
    <div class="skeleton" style="width:90%"></div>
    <div class="skeleton" style="width:70%"></div>
  </div>
</div>

<!-- ========== FINANCE ========== -->
<div class="tab-content" id="tab-finance">
  <div class="section-title">ğŸ’° Finance Tracker</div>
  
  <!-- Monthly summary -->
  <div class="grid grid-3" style="margin-bottom:16px">
    <div class="card stat"><div class="num" id="finIncome" style="color:var(--green)">$0</div><div class="label">Income</div></div>
    <div class="card stat"><div class="num" id="finExpense" style="color:var(--red)">$0</div><div class="label">Expenses</div></div>
    <div class="card stat"><div class="num" id="finNet">$0</div><div class="label">Net</div></div>
  </div>

  <!-- Pie chart -->
  <div class="card" style="margin-bottom:16px">
    <h3>ğŸ“Š Expense Breakdown</h3>
    <div class="pie-container" id="pieContainer">
      <div style="color:var(--muted);font-size:13px">Loading...</div>
    </div>
  </div>

  <!-- Filter -->
  <div class="filter-chips" id="finFilters">
    <span class="chip active" onclick="filterFinance('all',this)">All</span>
    <span class="chip" onclick="filterFinance('income',this)">ğŸ’š Income</span>
    <span class="chip" onclick="filterFinance('expense',this)">ğŸ”´ Expense</span>
  </div>

  <div id="financeList">
    <div class="skeleton" style="width:90%"></div>
    <div class="skeleton" style="width:70%"></div>
  </div>
</div>

<!-- ========== READING ========== -->
<div class="tab-content" id="tab-reading">
  <div class="section-title">ğŸ“– Reading List</div>
  
  <div class="filter-chips" id="readFilters">
    <span class="chip active" onclick="filterReading('all',this)">All</span>
    <span class="chip" onclick="filterReading('reading',this)">ğŸ“– Reading</span>
    <span class="chip" onclick="filterReading('finished',this)">âœ… Finished</span>
    <span class="chip" onclick="filterReading('wishlist',this)">ğŸ“‹ Wishlist</span>
  </div>

  <div id="readingList">
    <div class="skeleton" style="width:90%"></div>
    <div class="skeleton" style="width:70%"></div>
  </div>
</div>

<!-- ========== GOALS ========== -->
<div class="tab-content" id="tab-goals">
  <div class="section-title">ğŸ¯ Goals</div>
  
  <div class="filter-chips" id="goalFilters">
    <span class="chip active" onclick="filterGoals('all',this)">All</span>
    <span class="chip" onclick="filterGoals('career',this)">ğŸ’¼ Career</span>
    <span class="chip" onclick="filterGoals('health',this)">ğŸƒ Health</span>
    <span class="chip" onclick="filterGoals('finance',this)">ğŸ’° Finance</span>
    <span class="chip" onclick="filterGoals('personal',this)">ğŸ§  Personal</span>
  </div>

  <div id="goalsList">
    <div class="skeleton" style="width:90%"></div>
    <div class="skeleton" style="width:70%"></div>
  </div>
</div>

<!-- ========== IDEAS ========== -->
<div class="tab-content" id="tab-ideas">
  <div class="section-title">ğŸ’¡ Ideas</div>
  
  <div class="filter-chips" id="ideaFilters">
    <span class="chip active" onclick="filterIdeas('all',this)">All</span>
    <span class="chip" onclick="filterIdeas('product',this)">ğŸ“¦ Product</span>
    <span class="chip" onclick="filterIdeas('content',this)">ğŸ“ Content</span>
    <span class="chip" onclick="filterIdeas('business',this)">ğŸ’¼ Business</span>
    <span class="chip" onclick="filterIdeas('tech',this)">ğŸ”§ Tech</span>
  </div>

  <div id="ideasList">
    <div class="skeleton" style="width:90%"></div>
    <div class="skeleton" style="width:70%"></div>
  </div>
</div>

<!-- Bottom Sheet Overlay -->
<div class="bottom-sheet-overlay" id="bsOverlay" onclick="closeForm()"></div>
<div class="bottom-sheet" id="bsSheet">
  <div class="handle"></div>
  <h3 id="bsTitle"></h3>
  <div id="bsFields"></div>
  <div class="btn-row" id="bsBtnRow">
    <button class="submit-btn" id="bsSubmit" onclick="submitForm()">Save</button>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// === State ===
let currentTab = 'dashboard';
let currentFormType = '';
let editingId = null;
let editingSheet = null;
let deleteId = null;
let deleteSheet = null;
let calMonth = new Date().getMonth();
let calYear = new Date().getFullYear();

// Data caches
let DATA = {};

// === Tab switching ===
function switchTab(id, el) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-bar-item').forEach(b => b.classList.remove('active'));
  const tab = document.getElementById('tab-' + id);
  if (tab) tab.classList.add('active');
  if (el && el.classList) el.classList.add('active');
  currentTab = id;
  
  // Show FAB for tabs that support adding
  const fabTabs = ['fitness','olivia','inventory','finance','reading','goals','ideas'];
  const fab = document.getElementById('fab');
  fab.classList.toggle('visible', fabTabs.includes(id));
  
  // Load data on first visit
  loadTabData(id);
}

function toggleMore(e) {
  e.stopPropagation();
  document.getElementById('moreMenu').classList.toggle('active');
}
function closeMore() { document.getElementById('moreMenu').classList.remove('active'); }
document.addEventListener('click', e => { if (!e.target.closest('.more-menu') && !e.target.closest('.tab-bar-item')) closeMore(); });

// FAB action
function fabAction() {
  const formMap = {fitness:'fitness',olivia:'olivia',inventory:'inventory',finance:'finance',reading:'reading',goals:'goals',ideas:'ideas'};
  if (formMap[currentTab]) openForm(formMap[currentTab]);
}

// Theme
function toggleTheme() {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-theme') === 'dark';
  html.setAttribute('data-theme', isDark ? 'light' : 'dark');
  document.querySelector('.theme-btn').textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
}

// === Google Sheets API Layer ===
const API = {
  async get(sheet) {
    if (!SB_CONFIG.API_URL) return null;
    try {
      const r = await fetch(`${SB_CONFIG.API_URL}?key=${SB_CONFIG.API_KEY}&sheet=${sheet}`);
      return await r.json();
    } catch(e) { console.warn('API get failed:', e); return null; }
  },
  async post(action, sheet, data, id) {
    if (!SB_CONFIG.API_URL) { showToast('API not configured', 'error'); return null; }
    try {
      const r = await fetch(SB_CONFIG.API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: JSON.stringify({ key: SB_CONFIG.API_KEY, action, sheet, data, id })
      });
      return await r.json();
    } catch(e) { showToast('Failed: ' + e.message, 'error'); return null; }
  }
};

function genId() { return Date.now().toString(36) + Math.random().toString(36).slice(2, 6); }

// === Toast ===
let _toastTimer;
function showToast(msg, type='success') {
  const t = document.getElementById('toast');
  t.textContent = (type === 'success' ? 'âœ… ' : 'âŒ ') + msg;
  t.className = 'toast ' + type + ' show';
  clearTimeout(_toastTimer);
  _toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
}

// === Delete Modal ===
function openDeleteModal(id, sheet) {
  deleteId = id; deleteSheet = sheet;
  document.getElementById('deleteModal').classList.add('active');
}
function closeDeleteModal() {
  document.getElementById('deleteModal').classList.remove('active');
  deleteId = null; deleteSheet = null;
}
async function confirmDelete() {
  if (!deleteId || !deleteSheet) return;
  const res = await API.post('delete', deleteSheet, null, deleteId);
  closeDeleteModal();
  if (res && res.success) { showToast('å·²åˆ é™¤'); await new Promise(r => setTimeout(r, 1500)); loadTabData(currentTab, true); }
  else showToast('Delete failed', 'error');
}

// === Date & Countdowns ===
function daysUntil(month, day) {
  const now = new Date();
  let target = new Date(now.getFullYear(), month - 1, day);
  if (target < now) target.setFullYear(target.getFullYear() + 1);
  return Math.ceil((target - now) / 86400000);
}

function updateDate() {
  const now = new Date();
  document.getElementById('todayDate').textContent = now.toLocaleDateString('en-AU', { weekday:'long',year:'numeric',month:'long',day:'numeric',timeZone:'Australia/Sydney'});
  const hour = now.getHours();
  document.getElementById('todayGreeting').textContent = hour < 12 ? 'Good morning, Dong â˜€ï¸' : hour < 18 ? 'Good afternoon, Dong ğŸŒ¤ï¸' : 'Good evening, Dong ğŸŒ™';
}

function updateCountdowns() {
  const events = [
    { name: 'ğŸ’’ ç»“å©šçºªå¿µæ—¥', date: 'March 5', m: 3, d: 5 },
    { name: 'ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡æ—…è¡Œ', date: 'Apr-May', m: 4, d: 15 },
    { name: 'ğŸ‡¯ğŸ‡µ Japan Trip', date: 'June 12', m: 6, d: 12 },
    { name: 'ğŸ‚ Olivia Birthday', date: 'June 17', m: 6, d: 17 },
    { name: 'ğŸš€ Oney & Co Launch', date: 'July 2026', m: 7, d: 1 },
  ];
  document.getElementById('countdowns').innerHTML = events.map(e => {
    const d = daysUntil(e.m, e.d);
    return `<div class="countdown"><div class="days">${d}d</div><div class="info"><div class="name">${e.name}</div><div class="date">${e.date}</div></div></div>`;
  }).join('');
}

// === Olivia Countdowns ===
function updateOliviaCountdowns() {
  const a = document.getElementById('oliviaAnniv');
  const b = document.getElementById('oliviaBday');
  if (a) a.textContent = daysUntil(3, 5) + 'å¤©';
  if (b) b.textContent = daysUntil(6, 17) + 'å¤©';
}

// === QuickNotes ===
async function loadQuickNotes() {
  const data = await API.get('QuickNotes');
  const list = document.getElementById('qnList');
  if (!data?.rows?.length) { list.innerHTML = '<div style="color:var(--muted);font-size:13px;text-align:center;padding:12px">No notes yet. Say something!</div>'; return; }
  list.innerHTML = data.rows.slice(-10).reverse().map(r =>
    `<div class="qn-item from-${(r.from||'dong').toLowerCase()}"><span>${r.note}</span><span class="qn-meta">${r.from||''} Â· ${(r.timestamp||'').slice(0,16)}</span></div>`
  ).join('');
}

async function sendQuickNote() {
  const input = document.getElementById('qnInput');
  const note = input.value.trim();
  if (!note) return;
  input.value = '';
  const res = await API.post('append', 'QuickNotes', { id: genId(), timestamp: new Date().toISOString(), note, from: 'Dong' });
  if (res?.success) { showToast('Note sent!'); loadQuickNotes(); }
}

// === Generic Record Renderer ===
function renderRecords(containerId, rows, sheet, renderFn) {
  const container = document.getElementById(containerId);
  if (!rows?.length) { container.innerHTML = `<div style="color:var(--muted);font-size:13px;text-align:center;padding:20px">No records yet. Tap ï¼‹ to add!</div>`; return; }
  container.innerHTML = rows.map(r => {
    const body = renderFn(r);
    return `<div class="record-item" data-id="${r.id}" data-category="${(r.category||r.type||'').toLowerCase()}">
      <div class="record-main">
        <div class="record-body">${body}</div>
        <div class="record-actions">
          <button onclick="editRecord('${sheet}','${r.id}')" title="Edit">âœï¸</button>
          <button class="btn-del" onclick="openDeleteModal('${r.id}','${sheet}')" title="Delete">ğŸ—‘ï¸</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

// === Edit Record ===
function editRecord(sheet, id) {
  const rows = DATA[sheet];
  if (!rows) return;
  const row = rows.find(r => r.id === id);
  if (!row) return;
  
  // Map sheet to form type
  const sheetFormMap = { Fitness:'fitness', Inventory:'inventory', Finance:'finance', Reading:'reading', Goals:'goals', Ideas:'ideas', Olivia:'olivia' };
  const formType = sheetFormMap[sheet];
  if (!formType) return;
  
  editingId = id;
  editingSheet = sheet;
  openForm(formType, row);
}

// === Form Definitions ===
const FORMS = {
  memory: { title:'ğŸ§  Add Memory', sheet:'Memory', fields:[
    {name:'date',label:'Date',type:'date',default:()=>new Date().toISOString().slice(0,10)},
    {name:'category',label:'Category',type:'select',options:['Strategy','Daily','Event','Family','Products','Security']},
    {name:'title',label:'Title',type:'text'},
    {name:'content',label:'Content',type:'textarea'},
    {name:'tags',label:'Tags',type:'text'}
  ]},
  contact: { title:'ğŸ‘¥ Add Contact', sheet:'Contacts', fields:[
    {name:'name',label:'Name',type:'text'},
    {name:'role',label:'Role',type:'text'},
    {name:'category',label:'Category',type:'select',options:['Family','Industry','NAB','Aggregator','Client','Other']},
    {name:'lastContact',label:'Last Contact',type:'date'},
    {name:'notes',label:'Notes',type:'textarea'}
  ]},
  todo: { title:'ğŸ“ Add Todo', sheet:'Todos', fields:[
    {name:'text',label:'Task',type:'text'},
    {name:'priority',label:'Priority',type:'select',options:['high','medium','low']}
  ]},
  knowledge: { title:'ğŸ“š Add Knowledge', sheet:'Knowledge', fields:[
    {name:'category',label:'Category',type:'select',options:['Industry Terms','Lender Notes','Competitive Intel','Documents']},
    {name:'title',label:'Title',type:'text'},
    {name:'content',label:'Content',type:'textarea'}
  ]},
  fitness: { title:'ğŸ’ª Log Workout', sheet:'Fitness', fields:[
    {name:'date',label:'Date',type:'date',default:()=>new Date().toISOString().slice(0,10)},
    {name:'type',label:'Type',type:'select',options:['run','strength','pt','football','tennis','walk','swim','yoga','other']},
    {name:'exercise',label:'Exercise',type:'text'},
    {name:'sets',label:'Sets',type:'number'},
    {name:'reps',label:'Reps',type:'number'},
    {name:'weight',label:'Weight (kg)',type:'number'},
    {name:'duration',label:'Duration (min)',type:'number'},
    {name:'notes',label:'Notes',type:'textarea'}
  ]},
  inventory: { title:'ğŸ“¦ Add Item', sheet:'Inventory', fields:[
    {name:'category',label:'Category',type:'select',options:['kitchen','bathroom','cleaning','medicine','pantry','laundry','other']},
    {name:'item',label:'Item',type:'text'},
    {name:'quantity',label:'Quantity',type:'number'},
    {name:'location',label:'Location',type:'text'},
    {name:'lastChecked',label:'Last Checked',type:'date',default:()=>new Date().toISOString().slice(0,10)},
    {name:'notes',label:'Notes (low threshold etc)',type:'textarea'}
  ]},
  finance: { title:'ğŸ’° Add Transaction', sheet:'Finance', fields:[
    {name:'date',label:'Date',type:'date',default:()=>new Date().toISOString().slice(0,10)},
    {name:'type',label:'Type',type:'select',options:['income','expense']},
    {name:'category',label:'Category',type:'select',options:['salary','freelance','tools','food','transport','shopping','bills','health','entertainment','travel','other']},
    {name:'description',label:'Description',type:'text'},
    {name:'amount',label:'Amount ($)',type:'number'},
    {name:'account',label:'Account',type:'select',options:['NAB','CommBank','IBKR','Cash','Other']},
    {name:'notes',label:'Notes',type:'textarea'}
  ]},
  reading: { title:'ğŸ“– Add Book', sheet:'Reading', fields:[
    {name:'date',label:'Date Added',type:'date',default:()=>new Date().toISOString().slice(0,10)},
    {name:'type',label:'Type',type:'select',options:['book','article','podcast','video']},
    {name:'title',label:'Title',type:'text'},
    {name:'author',label:'Author',type:'text'},
    {name:'status',label:'Status',type:'select',options:['wishlist','reading','finished','abandoned']},
    {name:'rating',label:'Rating (1-5)',type:'number'},
    {name:'notes',label:'Notes',type:'textarea'}
  ]},
  goals: { title:'ğŸ¯ Add Goal', sheet:'Goals', fields:[
    {name:'category',label:'Category',type:'select',options:['career','health','finance','personal','relationship']},
    {name:'title',label:'Goal',type:'text'},
    {name:'target',label:'Target',type:'text'},
    {name:'current',label:'Current Progress',type:'text'},
    {name:'deadline',label:'Deadline',type:'date'},
    {name:'status',label:'Status',type:'select',options:['active','completed','paused','abandoned']},
    {name:'notes',label:'Notes',type:'textarea'}
  ]},
  ideas: { title:'ğŸ’¡ Add Idea', sheet:'Ideas', fields:[
    {name:'timestamp',label:'Date',type:'date',default:()=>new Date().toISOString().slice(0,10)},
    {name:'category',label:'Category',type:'select',options:['product','content','business','tech','other']},
    {name:'idea',label:'Idea',type:'textarea'},
    {name:'status',label:'Status',type:'select',options:['new','exploring','in-progress','done','parked']}
  ]},
  olivia: { title:'â¤ï¸ Add for Olivia', sheet:'Olivia', fields:[
    {name:'date',label:'Date',type:'date',default:()=>new Date().toISOString().slice(0,10)},
    {name:'category',label:'Category',type:'select',options:['anniversary','birthday','preferences','gifts','memories']},
    {name:'content',label:'Content',type:'textarea'},
    {name:'notes',label:'Notes',type:'textarea'}
  ]}
};

function openForm(type, prefill) {
  currentFormType = type;
  const form = FORMS[type];
  const isEdit = !!prefill;
  document.getElementById('bsTitle').textContent = isEdit ? form.title.replace('Add','Edit').replace('Log','Edit') : form.title;
  document.getElementById('bsFields').innerHTML = form.fields.map(f => {
    const val = prefill ? (prefill[f.name]||'') : (f.default ? f.default() : '');
    if (f.type === 'textarea') return `<label>${f.label}</label><textarea id="bs_${f.name}" placeholder="${f.label}">${val}</textarea>`;
    if (f.type === 'select') return `<label>${f.label}</label><select id="bs_${f.name}">${f.options.map(o=>`<option value="${o}"${val===o?' selected':''}>${o}</option>`).join('')}</select>`;
    return `<label>${f.label}</label><input type="${f.type||'text'}" id="bs_${f.name}" placeholder="${f.label}" value="${val}">`;
  }).join('');
  
  document.getElementById('bsBtnRow').innerHTML = isEdit
    ? `<button class="cancel-btn" onclick="closeForm()" style="flex:1">Cancel</button><button class="submit-btn" onclick="submitForm()" style="flex:1">Update</button>`
    : `<button class="submit-btn" onclick="submitForm()">Save</button>`;
  
  document.getElementById('bsOverlay').classList.add('active');
  document.getElementById('bsSheet').classList.add('active');
}

function closeForm() {
  document.getElementById('bsOverlay').classList.remove('active');
  document.getElementById('bsSheet').classList.remove('active');
  editingId = null; editingSheet = null;
}

async function submitForm() {
  const form = FORMS[currentFormType];
  const btn = document.querySelector('#bsBtnRow .submit-btn');
  btn.disabled = true; btn.textContent = 'Saving...';

  const data = {};
  form.fields.forEach(f => { data[f.name] = document.getElementById('bs_'+f.name).value; });

  let res;
  if (editingId) {
    data.id = editingId;
    res = await API.post('update', editingSheet || form.sheet, data, editingId);
  } else {
    data.id = genId();
    if (currentFormType === 'todo') { data.status = 'pending'; data.created = new Date().toISOString().slice(0,10); }
    res = await API.post('append', form.sheet, data);
  }

  btn.disabled = false; btn.textContent = editingId ? 'Update' : 'Save';
  console.log('API response:', JSON.stringify(res));
  if (res?.success || res?.result === 'success') {
    showToast(editingId ? 'Updated!' : 'Added!');
    closeForm();
    showToast('â³ Syncing...');
    await new Promise(r => setTimeout(r, 2000));
    await loadTabData(currentTab, true);
    showToast('âœ… Done!');
  } else {
    showToast('Failed: ' + JSON.stringify(res), 'error');
  }
}

// === Quick Workout ===
async function quickWorkout(type, label) {
  const data = { id: genId(), date: new Date().toISOString().slice(0,10), type, exercise: label, sets:'', reps:'', weight:'', duration:'', notes:'Quick check-in' };
  const res = await API.post('append', 'Fitness', data);
  if (res?.success || res?.result === 'success') { showToast('ğŸ’ª ' + label + ' logged!'); await new Promise(r => setTimeout(r, 2000)); loadTabData('fitness', true); }
}

// === Data Loading ===
async function loadTabData(tab, force) {
  switch(tab) {
    case 'dashboard': loadQuickNotes(); loadTodos(); break;
    case 'fitness': await loadFitness(force); break;
    case 'olivia': updateOliviaCountdowns(); await loadOlivia(force); break;
    case 'inventory': await loadInventory(force); break;
    case 'finance': await loadFinance(force); break;
    case 'reading': await loadReading(force); break;
    case 'goals': await loadGoals(force); break;
    case 'ideas': await loadIdeas(force); break;
  }
}

async function loadTodos() {
  const data = await API.get('Todos');
  if (!data?.rows?.length) return;
  document.getElementById('todosContainer').innerHTML = data.rows.map(r =>
    `<div class="todo"><span class="check ${r.status==='done'?'done':''}" onclick="toggleTodo('${r.id}','${r.status}')">${r.status==='done'?'âœ“':'â—‹'}</span><div class="text">${r.text}</div><button class="todo-del" onclick="openDeleteModal('${r.id}','Todos')" title="Delete">ğŸ—‘ï¸</button></div>`
  ).join('');
}

async function toggleTodo(id, currentStatus) {
  const newStatus = currentStatus === 'done' ? 'pending' : 'done';
  await API.post('update', 'Todos', { status: newStatus }, id);
  await new Promise(r => setTimeout(r, 1000));
  loadTodos();
}

async function refreshAll() {
  const btn = document.querySelector('.refresh-btn');
  btn.style.animation = 'spin .8s linear infinite';
  DATA = {};
  await loadTabData(currentTab, true);
  btn.style.animation = '';
  showToast('ğŸ”„ Refreshed!');
}

// === Fitness ===
async function loadFitness(force) {
  if (DATA.Fitness && !force) { renderFitness(); return; }
  const data = await API.get('Fitness');
  DATA.Fitness = data?.rows || [];
  renderFitness();
}

function renderFitness() {
  const rows = DATA.Fitness || [];
  
  // Stats
  const now = new Date();
  const weekStart = new Date(now); weekStart.setDate(now.getDate() - now.getDay());
  const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
  const ws = weekStart.toISOString().slice(0,10);
  const ms = monthStart.toISOString().slice(0,10);
  
  document.getElementById('fitWeek').textContent = rows.filter(r => r.date >= ws).length;
  document.getElementById('fitMonth').textContent = rows.filter(r => r.date >= ms).length;
  
  // Streak
  let streak = 0;
  const dates = [...new Set(rows.map(r=>r.date))].sort().reverse();
  let check = new Date().toISOString().slice(0,10);
  for (const d of dates) {
    if (d === check) { streak++; const dt = new Date(check); dt.setDate(dt.getDate()-1); check = dt.toISOString().slice(0,10); }
    else if (d < check) break;
  }
  document.getElementById('fitStreak').textContent = streak;
  
  // Calendar
  renderFitCalendar(rows);
  
  // Log
  renderRecords('fitnessLog', [...rows].reverse().slice(0,20), 'Fitness', r => {
    const icons = {run:'ğŸƒ',strength:'ğŸ’ª',pt:'ğŸ‹ï¸',football:'âš½',tennis:'ğŸ¾',walk:'ğŸš¶',swim:'ğŸŠ',yoga:'ğŸ§˜'};
    return `<div class="record-title">${icons[r.type]||'ğŸ…'} ${r.exercise||r.type}</div>
      <div class="record-sub">${[r.sets&&r.sets+'sets',r.reps&&r.reps+'reps',r.weight&&r.weight+'kg',r.duration&&r.duration+'min'].filter(Boolean).join(' Â· ')||'Quick check-in'}</div>
      <div class="record-meta">${r.date}${r.notes?' Â· '+r.notes:''}</div>`;
  });
}

function renderFitCalendar(rows) {
  const workoutDates = new Set(rows.map(r=>r.date));
  const first = new Date(calYear, calMonth, 1);
  const last = new Date(calYear, calMonth + 1, 0);
  const today = new Date().toISOString().slice(0,10);
  
  document.getElementById('calMonthLabel').textContent = first.toLocaleDateString('en-AU',{month:'long',year:'numeric'});
  
  let html = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d=>`<div class="fit-cal-header">${d}</div>`).join('');
  for (let i = 0; i < first.getDay(); i++) html += '<div class="fit-cal-day empty"></div>';
  for (let d = 1; d <= last.getDate(); d++) {
    const ds = `${calYear}-${String(calMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const isToday = ds === today;
    const hasW = workoutDates.has(ds);
    html += `<div class="fit-cal-day${isToday?' today':''}${hasW?' has-workout':''}">${d}</div>`;
  }
  document.getElementById('fitCalendar').innerHTML = html;
}

function changeCalMonth(delta) {
  calMonth += delta;
  if (calMonth > 11) { calMonth = 0; calYear++; }
  if (calMonth < 0) { calMonth = 11; calYear--; }
  renderFitCalendar(DATA.Fitness || []);
}

// === Olivia ===
async function loadOlivia(force) {
  if (DATA.Olivia && !force) { renderOlivia(); return; }
  const data = await API.get('Olivia');
  DATA.Olivia = data?.rows || [];
  renderOlivia();
}
function renderOlivia(filter='all') {
  const rows = filter === 'all' ? (DATA.Olivia||[]) : (DATA.Olivia||[]).filter(r=>(r.category||'').toLowerCase()===filter);
  renderRecords('oliviaList', [...rows].reverse(), 'Olivia', r => {
    const icons = {anniversary:'ğŸ’’',birthday:'ğŸ‚',preferences:'â­',gifts:'ğŸ',memories:'ğŸ’'};
    return `<div class="record-title">${icons[r.category]||'â¤ï¸'} ${r.content?.slice(0,60)||'...'}</div>
      <div class="record-sub">${r.category||''}</div>
      <div class="record-meta">${r.date||''}${r.notes?' Â· '+r.notes:''}</div>`;
  });
}
function filterOlivia(cat, el) {
  document.querySelectorAll('#oliviaFilters .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderOlivia(cat);
}

// === Inventory ===
async function loadInventory(force) {
  if (DATA.Inventory && !force) { renderInventory(); return; }
  const data = await API.get('Inventory');
  DATA.Inventory = data?.rows || [];
  renderInventory();
}
function renderInventory(filter='all') {
  const rows = filter === 'all' ? (DATA.Inventory||[]) : (DATA.Inventory||[]).filter(r=>(r.category||'').toLowerCase()===filter);
  renderRecords('inventoryList', rows, 'Inventory', r => {
    const qty = parseInt(r.quantity)||0;
    const threshold = parseInt((r.notes||'').match(/threshold[:\s]*(\d+)/i)?.[1]) || 2;
    const low = qty <= threshold;
    return `<div class="record-title">${r.item} <span class="${low?'low-stock':''}" style="font-size:12px;${low?'':'color:var(--muted)'}">Ã—${qty}</span></div>
      <div class="record-sub">ğŸ“ ${r.location||'â€”'} Â· ${r.category||''}</div>
      <div class="record-meta">Last checked: ${r.lastChecked||'â€”'}</div>`;
  });
}
function filterInventory(cat, el) {
  document.querySelectorAll('#invFilters .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderInventory(cat);
}

// === Finance ===
async function loadFinance(force) {
  if (DATA.Finance && !force) { renderFinance(); return; }
  const data = await API.get('Finance');
  DATA.Finance = data?.rows || [];
  renderFinance();
}
function renderFinance(filter='all') {
  const rows = DATA.Finance || [];
  const now = new Date();
  const thisMonth = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}`;
  const monthRows = rows.filter(r => (r.date||'').startsWith(thisMonth));
  
  const income = monthRows.filter(r=>r.type==='income').reduce((s,r)=>s+parseFloat(r.amount||0),0);
  const expense = monthRows.filter(r=>r.type==='expense').reduce((s,r)=>s+parseFloat(r.amount||0),0);
  
  document.getElementById('finIncome').textContent = '$' + income.toLocaleString();
  document.getElementById('finExpense').textContent = '$' + expense.toLocaleString();
  const net = income - expense;
  const netEl = document.getElementById('finNet');
  netEl.textContent = (net >= 0 ? '+$' : '-$') + Math.abs(net).toLocaleString();
  netEl.style.color = net >= 0 ? 'var(--green)' : 'var(--red)';
  
  // Pie chart
  renderPieChart(monthRows.filter(r=>r.type==='expense'));
  
  // List
  const filtered = filter === 'all' ? rows : rows.filter(r=>r.type===filter);
  renderRecords('financeList', [...filtered].reverse().slice(0,30), 'Finance', r => {
    const isIncome = r.type === 'income';
    return `<div class="record-title">${r.description||r.category} <span style="color:${isIncome?'var(--green)':'var(--red)'}; font-size:13px">${isIncome?'+':'-'}$${parseFloat(r.amount||0).toLocaleString()}</span></div>
      <div class="record-sub">${r.category||''} Â· ${r.account||''}</div>
      <div class="record-meta">${r.date||''}</div>`;
  });
}
function filterFinance(cat, el) {
  document.querySelectorAll('#finFilters .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderFinance(cat);
}

function renderPieChart(expenses) {
  const container = document.getElementById('pieContainer');
  if (!expenses.length) { container.innerHTML = '<div style="color:var(--muted);font-size:13px">No expenses this month</div>'; return; }
  
  const cats = {};
  expenses.forEach(r => { cats[r.category||'other'] = (cats[r.category||'other']||0) + parseFloat(r.amount||0); });
  const total = Object.values(cats).reduce((a,b)=>a+b,0);
  const colors = ['#2ECC85','#6B4C9A','#3498db','#f39c12','#e74c3c','#ec4899','#14b8a6','#8b5cf6'];
  
  let gradient = '';
  let offset = 0;
  const entries = Object.entries(cats).sort((a,b)=>b[1]-a[1]);
  entries.forEach(([cat, amt], i) => {
    const pct = (amt/total)*100;
    const color = colors[i%colors.length];
    gradient += `${color} ${offset}% ${offset+pct}%,`;
    offset += pct;
  });
  
  container.innerHTML = `
    <div class="pie" style="background:conic-gradient(${gradient.slice(0,-1)})"></div>
    <div class="pie-legend">${entries.map(([cat,amt],i) => 
      `<div class="pie-legend-item"><div class="dot" style="background:${colors[i%colors.length]}"></div>${cat} $${amt.toLocaleString()} (${Math.round(amt/total*100)}%)</div>`
    ).join('')}</div>`;
}

// === Reading ===
async function loadReading(force) {
  if (DATA.Reading && !force) { renderReading(); return; }
  const data = await API.get('Reading');
  DATA.Reading = data?.rows || [];
  renderReading();
}
function renderReading(filter='all') {
  const rows = filter === 'all' ? (DATA.Reading||[]) : (DATA.Reading||[]).filter(r=>(r.status||'').toLowerCase()===filter);
  renderRecords('readingList', [...rows].reverse(), 'Reading', r => {
    const stars = r.rating ? 'â­'.repeat(Math.min(parseInt(r.rating),5)) : '';
    const statusColors = {reading:'var(--green)',finished:'var(--blue)',wishlist:'var(--orange)',abandoned:'var(--muted)'};
    return `<div class="record-title">${r.title||'Untitled'} ${stars}</div>
      <div class="record-sub">by ${r.author||'â€”'} Â· ${r.type||'book'} Â· <span style="color:${statusColors[r.status]||'var(--muted)'}">${r.status||''}</span></div>
      <div class="record-meta">${r.date||''}${r.notes?' Â· '+r.notes:''}</div>`;
  });
}
function filterReading(cat, el) {
  document.querySelectorAll('#readFilters .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderReading(cat);
}

// === Goals ===
async function loadGoals(force) {
  if (DATA.Goals && !force) { renderGoals(); return; }
  const data = await API.get('Goals');
  DATA.Goals = data?.rows || [];
  renderGoals();
}
function renderGoals(filter='all') {
  const rows = filter === 'all' ? (DATA.Goals||[]) : (DATA.Goals||[]).filter(r=>(r.category||'').toLowerCase()===filter);
  renderRecords('goalsList', rows, 'Goals', r => {
    const statusColors = {active:'var(--green)',completed:'var(--blue)',paused:'var(--orange)',abandoned:'var(--muted)'};
    const progress = r.current && r.target ? `${r.current} / ${r.target}` : '';
    return `<div class="record-title">${r.title||'Untitled'} <span style="color:${statusColors[r.status]||'var(--muted)'}; font-size:11px">${r.status||''}</span></div>
      <div class="record-sub">${r.category||''} ${progress ? ' Â· '+progress : ''} ${r.deadline ? ' Â· Due '+r.deadline : ''}</div>
      <div class="record-meta">${r.notes||''}</div>`;
  });
}
function filterGoals(cat, el) {
  document.querySelectorAll('#goalFilters .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderGoals(cat);
}

// === Ideas ===
async function loadIdeas(force) {
  if (DATA.Ideas && !force) { renderIdeas(); return; }
  const data = await API.get('Ideas');
  DATA.Ideas = data?.rows || [];
  renderIdeas();
}
function renderIdeas(filter='all') {
  const rows = filter === 'all' ? (DATA.Ideas||[]) : (DATA.Ideas||[]).filter(r=>(r.category||'').toLowerCase()===filter);
  renderRecords('ideasList', [...rows].reverse(), 'Ideas', r => {
    const statusColors = {'new':'var(--green)',exploring:'var(--blue)','in-progress':'var(--orange)',done:'var(--muted)',parked:'var(--muted)'};
    return `<div class="record-title">${(r.idea||'').slice(0,80)}${(r.idea||'').length>80?'...':''}</div>
      <div class="record-sub">${r.category||''} Â· <span style="color:${statusColors[r.status]||'var(--muted)'}">${r.status||'new'}</span></div>
      <div class="record-meta">${r.timestamp||''}</div>`;
  });
}
function filterIdeas(cat, el) {
  document.querySelectorAll('#ideaFilters .chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderIdeas(cat);
}

// === Search ===
const searchInput = document.getElementById('searchInput');
const searchResults = document.getElementById('searchResults');
searchInput.addEventListener('input', function() {
  const q = this.value.toLowerCase().trim();
  if (!q) { searchResults.classList.remove('active'); return; }
  
  // Search across all cached data
  const results = [];
  Object.entries(DATA).forEach(([sheet, rows]) => {
    (rows||[]).forEach(r => {
      const text = Object.values(r).join(' ').toLowerCase();
      if (text.includes(q)) results.push({ cat: sheet, title: r.title||r.item||r.idea||r.exercise||r.description||r.content||'', text });
    });
  });
  
  if (!results.length) { searchResults.classList.remove('active'); return; }
  searchResults.innerHTML = results.slice(0,8).map(m =>
    `<div class="search-item"><div class="cat">${m.cat}</div><div class="title">${m.title.slice(0,50)}</div></div>`
  ).join('');
  searchResults.classList.add('active');
});
document.addEventListener('click', e => { if (!e.target.closest('.search-wrap')) searchResults.classList.remove('active'); });

// === Init ===
updateDate();
updateCountdowns();
setInterval(updateDate, 60000);

if (typeof SB_CONFIG !== 'undefined' && SB_CONFIG.API_URL) {
  const init = () => { loadQuickNotes(); loadTodos(); };
  if (document.readyState !== 'loading') init(); else document.addEventListener('DOMContentLoaded', init);
} else {
  document.addEventListener('DOMContentLoaded', () => {
    const qn = document.getElementById('qnList');
    if (qn) qn.innerHTML = '<div style="color:var(--muted);font-size:13px;text-align:center;padding:12px">ğŸ“¡ Connect Google Sheets to enable</div>';
  });
}
</script>
</body>
</html>
